#!/usr/bin/env bash
set -euo pipefail

ROOT_DIR="${1:-$(pwd)}"
OUTPUT_FILE="git-remotes-list.txt"

> "$OUTPUT_FILE"

fdfind -H -I '^\.git$' "$ROOT_DIR" | while read -r gitpath; do
  repo_dir="$(dirname "$gitpath")"

  if git -C "$repo_dir" rev-parse --is-inside-work-tree >/dev/null 2>&1; then
    git -C "$repo_dir" remote -v \
      | awk '/\(fetch\)/ {print $2}'
  fi
done | sort -u > "$OUTPUT_FILE"

echo "Done. Found URLs: $(wc -l < "$OUTPUT_FILE")"
echo "Output: $OUTPUT_FILE"
